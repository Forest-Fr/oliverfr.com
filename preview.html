<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Section0 Carousel</title>
  <style>
    /* =========================
       Carousel layout (Peek Preview)
       ========================= */

    /* Desktop */
    @media (min-width: 769px) {
      .section0-carousel{
        position: relative;
        width: 100%;
        height: 520px;
        overflow: hidden;
        margin: 10px auto 30px auto;
        padding: 0 10%;
        box-sizing: border-box;
        touch-action: pan-y; /* 允许上下滚动；横向由脚本识别 */
      }
      .section0-track{
        display: flex;
        gap: 15px;
        justify-content: flex-start;
        will-change: transform;
      }
      .section0-slide{
        flex: 0 0 auto;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 1 !important;
        transition: opacity .3s ease-in-out;
        position: relative;
        border-radius: 10px;
        overflow: hidden;
      }
      .section0-slide img{
        width: 100%;
        height: auto;
        display: block;
        border-radius: 10px;
        filter: none !important;
        opacity: 1 !important;
      }
    }

    /* Mobile */
    @media (max-width: 768px) {
      .section0-carousel{
        width: 100vw;
        padding-left: calc((100vw - 85vw) / 2);
        padding-right: calc((100vw - 85vw) / 2);
        overflow: hidden;
        margin: 5px auto 27px auto;
        position: relative;
        box-sizing: border-box;
        touch-action: pan-y; /* 上下滚动优先，横向滑动由脚本识别 */
      }
      .section0-track{
        display: flex;
        gap: 15px;
        align-items: center;
        will-change: transform;
      }
      .section0-slide{
        flex: 0 0 auto;
        width: 85vw;
        aspect-ratio: 9 / 16;
        overflow: hidden;
        position: relative;
        border-radius: 10px;
      }
      .section0-slide img{
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        filter: none !important;
        opacity: 1 !important;
      }
    }

    /* =========================
       Apple TV-like bar + dots + play (NO keyframes)
       ========================= */

    .section0-buttonRow{
      width: min(920px, 92vw);
      height: 44px;
      margin: 16px auto;
      position: sticky;
      top: 26px;
      z-index: 999;
      background: rgba(240,240,240,.96);
      border-radius: 999px;
      box-sizing: border-box;
      box-shadow: 0 10px 26px rgba(0,0,0,.08);
      transition: transform .35s ease, opacity .35s ease;
      opacity: 1;
    }
    .section0-buttonRow.is-hidden{
      opacity: 0;
      transform: translateY(-10px) scale(.96);
      pointer-events: none;
    }

    .btn-container{
      position: absolute;
      top: 50%;
      opacity: 1;
      pointer-events: auto;
    }
    #leftBtnContainer{
      left: 50%;
      transform: translate(-50%, -50%);
    }
    #rightBtnContainer{
      right: 10px;
      left: auto;
      transform: translateY(-50%);
    }

    #section0-leftCapsule{
      width: auto;
      height: auto;
      background: transparent;
      border: none;
      border-radius: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dots{
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 14px;
      user-select: none;
    }

    .dot{
      --dotS: 6px;
      --pillW: 36px;
      --pillH: 8px;

      width: var(--dotS);
      height: var(--dotS);
      border-radius: 999px;
      background: rgba(0,0,0,.30);
      opacity: .85;
      cursor: pointer;
      transition: width .26s ease, height .26s ease, background-color .26s ease, opacity .26s ease, transform .26s ease;
      transform: translateZ(0);
    }
    .dot.is-active{
      width: var(--pillW);
      height: var(--pillH);
      background: rgba(0,0,0,.78);
      opacity: 1;
    }
    .dot.is-active.is-pre{
      width: var(--dotS);
      height: var(--dotS);
      background: rgba(0,0,0,.45);
      opacity: .92;
    }

    /* ===== Play/Pause button ===== */
    #section0-rightButton{
      width: 34px;
      height: 34px;
      border: none;
      border-radius: 50%;
      background: rgba(0,0,0,.10);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.10);
      transition: transform .18s ease, background-color .18s ease, opacity .18s ease, box-shadow .18s ease;
    }
    #section0-rightButton:active{ transform: scale(.96); }

    /* ✅ 暂停时：按第一张截图的“浅灰圆 + 播放三角”风格 */
    #section0-rightButton.is-paused{
      background: rgba(0,0,0,.16);
      box-shadow: 0 6px 18px rgba(0,0,0,.12);
    }
    #section0-playIcon{
      font-size: 14px;
      line-height: 1;
      color: rgba(0,0,0,.72);
      letter-spacing: -1px;
      user-select: none;
      transform: translateX(1px);
    }
    #section0-rightButton.is-paused #section0-playIcon{
      color: rgba(0,0,0,.66);
    }

    /* =========================
       Center-slide overlay (match screenshot #2 style)
       - Only center clickable to open new window
       - Neighbors can only move left/right (click = prev/next), no open
       ========================= */
    .section0-heroOverlay{
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 18px 16px;
      color: #fff;
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .22s ease;
    }
    .section0-heroTitle{
      font-weight: 800;
      letter-spacing: .2px;
      margin: 0 0 8px 0;
      line-height: 1.1;
      font-size: clamp(20px, 3.8vw, 46px);
      text-shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    .section0-heroSub{
      margin: 0 0 12px 0;
      opacity: .92;
      line-height: 1.45;
      font-size: clamp(12px, 1.5vw, 18px);
      text-shadow: 0 10px 24px rgba(0,0,0,.30);
      max-width: 92%;
    }
    .section0-heroBtn{
      border: none;
      background: #1677ff;
      color: #fff;
      font-weight: 700;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 12px 28px rgba(0,0,0,.22);
      transition: transform .18s ease, filter .18s ease;
      user-select: none;
    }
    .section0-heroBtn:active{ transform: scale(.98); }

    /* Only center shows overlay + allowed to open */
    .section0-slide.is-center .section0-heroOverlay{
      opacity: 1;
      pointer-events: auto;
    }

    /* Cursor hinting */
    .section0-slide.is-center{ cursor: pointer; }
    .section0-slide.is-neighbor{ cursor: pointer; }
  </style>
</head>

<body>

  <!-- 轮播容器 -->
  <div class="section0-carousel">
    <div class="section0-track">
      <div class="section0-slide"><img src="slide1.jpg" alt="nature1" /></div>
      <div class="section0-slide"><img src="slide2.jpg" alt="nature2" /></div>
      <div class="section0-slide"><img src="slide3.jpg" alt="nature3" /></div>
    </div>
  </div>

  <!-- 按钮行容器 -->
  <div id="section0-buttonRow" class="section0-buttonRow is-hidden">
    <div id="leftBtnContainer" class="btn-container">
      <div id="section0-leftCapsule">
        <div class="dots" id="section0-dotsWrap">
          <div class="dot" data-index="0"></div>
          <div class="dot" data-index="1"></div>
          <div class="dot" data-index="2"></div>
        </div>
      </div>
    </div>

    <div id="rightBtnContainer" class="btn-container">
      <div id="section0-rightButton" aria-label="Play/Pause">
        <span id="section0-playIcon">❚❚</span>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const container = document.querySelector('.section0-carousel');
      const track = document.querySelector('.section0-track');
      const buttonRow = document.getElementById('section0-buttonRow');
      const rightButton = document.getElementById('section0-rightButton');
      const playIcon = document.getElementById('section0-playIcon');
      const dotsWrap = document.getElementById('section0-dotsWrap');

      if (!container || !track) return;

      const LINK_URL = 'https://oliverfr.com/agent-test.html';

      // ===== Speed (slower, keep friendly) =====
      const TRANSITION_MS = 680;     // ✅ 放慢：滑动更柔和
      const INTERVAL_MS   = 4500;    // ✅ 放慢：停留更久
      const SWIPE_PX_DESK = 50;
      const SWIPE_PX_MOB  = 35;      // ✅ 手机更灵敏

      // ===== Build triple clones (no flash on edges) =====
      let originalSlides = Array.from(track.querySelectorAll('.section0-slide'));
      const realCount = originalSlides.length;

      function syncDotsCount() {
        if (!dotsWrap) return;
        const exist = Array.from(dotsWrap.querySelectorAll('.dot'));
        if (exist.length === realCount) return;
        dotsWrap.innerHTML = '';
        for (let i = 0; i < realCount; i++) {
          const d = document.createElement('div');
          d.className = 'dot';
          d.dataset.index = String(i);
          dotsWrap.appendChild(d);
        }
      }

      function ensureOverlay(slide) {
        if (!slide) return;
        if (slide.querySelector('.section0-heroOverlay')) return;

        const overlay = document.createElement('div');
        overlay.className = 'section0-heroOverlay';
        overlay.innerHTML = `
          <div class="section0-heroTitle">MeFan AI 智能体——让运维与<br>开发更「自动」</div>
          <div class="section0-heroSub">
            基于 Python · FastAPI · LangChain · LangGraph · Supa · GitHub · Cloudflare · Google Cloud
            搭建的全栈 AI Agent 平台。
          </div>
          <button class="section0-heroBtn" type="button">Let&#39;s智能体</button>
        `;
        slide.appendChild(overlay);

        // CTA button click: open new window
        const btn = overlay.querySelector('.section0-heroBtn');
        if (btn) {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            window.open(LINK_URL, '_blank', 'noopener');
          });
        }
      }

      function cloneTriple() {
        if (realCount <= 1) return;

        const base = originalSlides.map(n => n.cloneNode(true));
        track.innerHTML = '';

        for (let pass = 0; pass < 3; pass++) {
          for (let i = 0; i < base.length; i++) {
            const node = base[i].cloneNode(true);
            node.dataset.realIndex = String(i);
            node.dataset.pass = String(pass);
            track.appendChild(node);
          }
        }
      }

      syncDotsCount();
      cloneTriple();

      let slides = Array.from(track.querySelectorAll('.section0-slide'));
      // Inject overlay into all clones (only center will show, via class)
      slides.forEach(ensureOverlay);

      // Start at middle copy
      let currentPos = (realCount > 1) ? realCount : 0;

      // ===== Measurements (precision to 3 decimals) =====
      let slideSpan = 0;

      function getGapPx() {
        const cs = getComputedStyle(track);
        const g = parseFloat(cs.columnGap || cs.gap || '0');
        return Number.isFinite(g) ? g : 0;
      }

      function recalcSpan() {
        if (!slides.length) return;
        const idx = Math.min(Math.max(currentPos, 0), slides.length - 1);
        const w = slides[idx].getBoundingClientRect().width;
        slideSpan = w + getGapPx();
      }

      function applyTransform(animated) {
        if (!slideSpan) recalcSpan();
        track.style.transition = animated
          ? `transform ${TRANSITION_MS}ms cubic-bezier(.22,.61,.36,1)`
          : 'none';

        const offset = currentPos * slideSpan;
        track.style.transform = `translateX(-${offset.toFixed(3)}px)`;
      }

      function getRealIndex() {
        if (realCount <= 1) return 0;
        const el = slides[currentPos];
        const ri = el ? parseInt(el.dataset.realIndex || '0', 10) : 0;
        return Number.isFinite(ri) ? ri : 0;
      }

      function setActiveDot(idx, pop) {
        const dots = Array.from(document.querySelectorAll('.dot'));
        dots.forEach(d => d.classList.remove('is-active', 'is-pre'));

        const active = dots[idx];
        if (!active) return;

        active.classList.add('is-active');
        if (pop) {
          active.classList.add('is-pre');
          requestAnimationFrame(() => active.classList.remove('is-pre'));
        }
      }

      function updateCenterClasses() {
        slides.forEach(s => s.classList.remove('is-center', 'is-neighbor'));

        const center = slides[currentPos];
        const left = slides[currentPos - 1];
        const right = slides[currentPos + 1];

        if (center) center.classList.add('is-center');
        if (left) left.classList.add('is-neighbor');
        if (right) right.classList.add('is-neighbor');
      }

      // ===== Infinite loop boundary fix =====
      function normalizeAfterTransition() {
        if (realCount <= 1) return;

        if (currentPos >= realCount * 2) {
          currentPos -= realCount;
          applyTransform(false);
        }
        if (currentPos < realCount) {
          currentPos += realCount;
          applyTransform(false);
        }
        updateCenterClasses();
      }

      track.addEventListener('transitionend', (e) => {
        if (e.propertyName !== 'transform') return;
        normalizeAfterTransition();
      });

      // ===== Autoplay (play/pause) =====
      let isPlaying = true;
      let timer = null;

      function updatePlayButtonUI() {
        if (!rightButton || !playIcon) return;
        if (isPlaying) {
          playIcon.textContent = '❚❚';
          rightButton.classList.remove('is-paused');
        } else {
          playIcon.textContent = '►';
          rightButton.classList.add('is-paused'); // ✅ 暂停时变为截图1风格
        }
      }

      function schedule() {
        clearTimeout(timer);
        if (!isPlaying || realCount <= 1) return;
        timer = setTimeout(() => {
          next(true);
          schedule();
        }, INTERVAL_MS);
      }

      function play() {
        isPlaying = true;
        updatePlayButtonUI();
        schedule();
      }

      function pause() {
        isPlaying = false;
        clearTimeout(timer);
        timer = null;
        updatePlayButtonUI();
      }

      // ===== Navigation =====
      function next(popDot) {
        if (realCount <= 1) return;
        currentPos += 1;
        applyTransform(true);
        setActiveDot(getRealIndex(), !!popDot);
        updateCenterClasses();
      }

      function prev(popDot) {
        if (realCount <= 1) return;
        currentPos -= 1;
        applyTransform(true);
        setActiveDot(getRealIndex(), !!popDot);
        updateCenterClasses();
      }

      function goToRealIndex(realIdx) {
        if (realCount <= 1) return;
        currentPos = realCount + realIdx; // middle copy
        applyTransform(true);
        setActiveDot(realIdx, true);
        updateCenterClasses();
        normalizeAfterTransition();
      }

      // ===== Controls =====
      if (rightButton) {
        rightButton.addEventListener('click', () => {
          if (isPlaying) pause();
          else play();
        });
      }

      // Dots click
      document.addEventListener('click', (e) => {
        const t = e.target;
        if (!t || !t.classList || !t.classList.contains('dot')) return;
        const idx = parseInt(t.getAttribute('data-index') || '0', 10);
        if (!Number.isFinite(idx)) return;

        const wasPlaying = isPlaying;
        goToRealIndex(idx);
        if (wasPlaying) schedule();
      });

      // ✅ Slide click behavior:
      // - center: open LINK_URL in new window
      // - neighbor / others: only move left/right, never open
      track.addEventListener('click', (e) => {
        const slide = e.target && e.target.closest ? e.target.closest('.section0-slide') : null;
        if (!slide) return;

        const idx = slides.indexOf(slide);
        if (idx < 0) return;

        // 如果点到了中心：打开新窗口
        if (idx === currentPos) {
          window.open(LINK_URL, '_blank', 'noopener');
          return;
        }

        // 非中心：只能左右移动（不打开）
        pause(); // 手动交互时暂停（更可控）
        if (idx < currentPos) prev(true);
        else next(true);
      });

      // ===== Touch swipe (more accurate + mobile sensitive) =====
      let sx = 0, sy = 0;
      let ex = 0, ey = 0;

      track.addEventListener('touchstart', (e) => {
        const t = e.touches && e.touches[0];
        if (!t) return;
        sx = t.clientX;
        sy = t.clientY;
      }, { passive: true });

      track.addEventListener('touchend', (e) => {
        const t = e.changedTouches && e.changedTouches[0];
        if (!t) return;
        ex = t.clientX;
        ey = t.clientY;

        const dx = ex - sx;
        const dy = ey - sy;

        // 只在“横向明显大于纵向”时才触发轮播，保证上下滚动丝滑
        if (Math.abs(dx) <= Math.abs(dy)) return;

        const thr = (window.innerWidth <= 768) ? SWIPE_PX_MOB : SWIPE_PX_DESK;
        if (Math.abs(dx) < thr) return;

        pause(); // 手动滑动暂停
        if (dx < 0) next(true);
        else prev(true);
      }, { passive: true });

      // ===== IntersectionObserver show/hide =====
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (!buttonRow) return;
          buttonRow.classList.toggle('is-hidden', !entry.isIntersecting);
        });
      }, { threshold: 0 });
      observer.observe(container);

      // Optional: keep original scroll nudge logic
      window.addEventListener('scroll', () => {
        if (!buttonRow) return;
        const br = buttonRow.getBoundingClientRect();
        buttonRow.style.transform = (br.bottom > window.innerHeight)
          ? 'translateY(-180px)'
          : (buttonRow.classList.contains('is-hidden') ? 'translateY(-10px) scale(.96)' : '');
      }, { passive: true });

      // ===== Resize =====
      window.addEventListener('resize', () => {
        recalcSpan();
        applyTransform(false);
      });

      // ===== Init =====
      function init() {
        recalcSpan();
        applyTransform(false);
        updateCenterClasses();

        // 初始 dot：小 -> 胶囊 pop
        setActiveDot(getRealIndex(), true);

        // 默认自动播放（无限）
        updatePlayButtonUI();
        play();
      }

      window.addEventListener('load', init, { once: true });
    })();
  </script>
</body>
</html>
