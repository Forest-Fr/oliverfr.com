<!-- admin-mefan-articles.html â€•â€• 2025-06-10 å½»åº•ä¿®å¤ç‰ˆ -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ–‡ç« åå°ç®¡ç†</title>
  <link rel="icon" href="MeFan Logo.png" type="image/x-icon"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <!-- æ ·å¼éƒ¨åˆ†ï¼ˆä¸ä¹‹å‰çš„ A ç‰ˆä¿æŒä¸€è‡´ï¼Œåªåšæ ¼å¼è°ƒæ•´ï¼‰ -->
  <style>
    body {
      font-family: Arial,Helvetica,sans-serif;
      background: #f8f8f8;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .btn {
      padding: 8px 16px;
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
      margin: 5px;
    }
    .btn:hover {
      background: #555;
    }
    .hidden {
      display: none;
    }
    textarea,
    input[type="text"],
    input[type="file"] {
      width: 100%;
      margin: 5px 0;
    }
    /* è¡¨æ ¼æ ·å¼ */
    table {
      width: 100%;
      max-width: 960px;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      table-layout: fixed;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    td.author,
    td.content {
      word-break: break-all;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 340px;
    }
    /* ç®¡ç†å·¥å…·æ¡ */
    .admin-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 960px;
      width: 100%;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .admin-bar > input {
      flex: 1;
      min-width: 200px;
      margin: 5px;
    }
    .admin-bar > div {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
      margin: 5px;
    }
    /* é¢„è§ˆå¼¹çª— */
    #previewModal {
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      max-width: 700px;
      width: 90%;
      z-index: 999;
      overflow-y: auto;
      max-height: 80vh;
    }
    #markdownContent {
      white-space: pre-wrap;
    }
    /* ç§»åŠ¨ç«¯å“åº”å¼ */
    @media (max-width: 768px) {
      .admin-bar {
        flex-direction: column;
        align-items: stretch;
      }
      .btn, textarea {
        width: 100%;
        margin: 5px 0;
      }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead {
        display: none;
      }
      tbody tr {
        border: 1px solid #ddd;
        margin-bottom: 15px;
        background: #fff;
        padding: 10px;
      }
      tbody td {
        display: flex;
        justify-content: space-between;
        padding: 8px 5px;
        border: none;
        border-bottom: 1px solid #eee;
      }
      tbody td::before {
        content: attr(data-label);
        font-weight: bold;
        color: #555;
        flex: 1;
        margin-right: 10px;
      }
      #submitBtn, #cancelEditBtn {
        width: 100%;
      }
    }
  </style>

  <!-- åªåŠ è½½ä¸€æ¬¡ Supabaseã€markedã€Editor.js çš„ç›¸å…³è„šæœ¬ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/paragraph@2.11.0/dist/bundle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@editorjs/header@2.7.0/dist/bundle.js"></script>
</head>
<body>
  <h1>ğŸ“° æ–‡ç« åå°ç®¡ç†</h1>

  <!-- ç™»å½•åŒº -->
  <div id="authArea">
    <button id="loginBtn" class="btn">ä½¿ç”¨ GitHub ç™»å½•</button>
  </div>

  <!-- ç®¡ç†åŒºï¼ˆåˆå§‹éšè—ï¼‰ -->
  <div id="adminArea" class="hidden">
    <!-- æœç´¢ + é€€å‡º -->
    <div class="admin-bar">
      <input type="text" id="searchInput" placeholder="æœç´¢æ ‡é¢˜å…³é”®è¯â€¦">
      <div>
        <button id="searchBtn" class="btn">ğŸ” æœç´¢</button>
        <button id="logoutBtn" class="btn">é€€å‡ºç™»å½•</button>
      </div>
    </div>

    <!-- æ–°å¢/ç¼–è¾‘åŒºåŸŸ -->
    <h2>ğŸ†• æ–°å¢/ç¼–è¾‘æ–‡ç« </h2>
    <input type="text" id="newTitle" placeholder="æ ‡é¢˜">
    <!-- ï¼ˆå¦‚æœä½ ä¿ç•™ SEO æè¿°/å…³é”®è¯ çš„è¾“å…¥æ¡†ï¼Œè¯·è§£é™¤ä¸‹é¢ä¸¤è¡Œæ³¨é‡Šï¼‰ -->
    <!-- <textarea id="seoDescriptionInput" placeholder="SEO æè¿° (å¯é€‰)"></textarea> -->
    <!-- <input type="text" id="keywordsInput" placeholder="SEO å…³é”®è¯ (ç”¨é€—å·åˆ†éš”, å¯é€‰)"> -->
    <div style="display: flex; gap: 10px; margin: 5px 0">
      <button id="toggleToEditor"   class="btn">ğŸ“ å¯è§†åŒ–æ¨¡å¼</button>
      <button id="toggleToTextarea" class="btn hidden">ğŸ–Š Markdown æ¨¡å¼</button>
    </div>
    <div id="editorContainer" class="hidden" style="border:1px solid #ccc; min-height:200px; padding:10px; background:#fff"></div>
    <textarea id="newContent" placeholder="æ”¯æŒ Markdown æ ¼å¼çš„å†…å®¹"></textarea>
    <input type="file" id="coverInput" accept="image/*">
    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0">
      <button id="submitBtn"             class="btn">æäº¤</button>
      <button id="cancelEditBtn"         class="btn hidden">å–æ¶ˆç¼–è¾‘</button>
      <button id="generateStaticHtmlBtn" class="btn">ç”Ÿæˆé™æ€æ–‡ç« æ–‡ä»¶</button>
      <button id="aiBtn"                 class="btn">AI ç”Ÿæˆæ–‡ç« ç»“æ„+SEO</button>
    </div>

    <!-- æ–‡ç« åˆ—è¡¨ -->
    <div style="overflow-x: auto; width: 100%">
      <table id="articlesTable">
        <thead>
          <tr>
            <th>æ ‡é¢˜</th><th>ä½œè€…</th><th>å†…å®¹</th><th>åˆ›å»ºæ—¶é—´</th>
            <th>æ›´æ–°æ—¶é—´</th><th>æ˜ŸæœŸ</th><th>å°é¢</th><th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- é¢„è§ˆå¼¹çª— -->
    <div id="previewModal" class="hidden">
      <h3 id="previewTitle"></h3>
      <img id="previewCover">
      <div id="markdownContent"></div>
      <button class="btn" onclick="closePreview()">å…³é—­</button>
    </div>
  </div>

  <!-- ============================================================
       å¼•å¯¼å™¨ï¼šåŠ¨æ€åŠ è½½ Editor.jsï¼ˆå¦‚æœå°šæœªåŠ è½½ï¼‰ï¼ŒåŠ è½½å®Œæˆåå†æ‰§è¡Œ main() ä¸­çš„æ‰€æœ‰é€»è¾‘
  ============================================================ -->
 <!-- =================================================================== -->
<!--   ä»¥ä¸‹ç¤ºä¾‹ä»…æ‘˜å–äº†â€œç”Ÿæˆé™æ€ HTML å¹¶ä¸Šä¼  GitHubâ€ è¿™ä¸€æ®µé€»è¾‘ï¼Œ  -->
<!--   ä»¥åŠæœ€å‰é¢è¦æŠŠ<script>æ ‡ç­¾æ‰“å¼€ã€ç»‘å®šEditorJSã€ç»‘å®šç™»å½•ç­‰éƒ½å†™å®Œå -->
<!--   å†æŠŠè¿™ä¸€æ•´æ®µè´´è¿›å»ï¼Œç¡®ä¿æ–‡ä»¶æ²¡æœ‰ç¼ºå°‘å¤§æ‹¬å·æˆ–åå¼•å·ã€‚         -->
<!-- =================================================================== -->

<script>
(function loadEditorJS(run) {
  if (window.EditorJS) { run(); return; }
  const s = document.createElement('script');
  s.src   = 'https://cdn.jsdelivr.net/npm/@editorjs/editorjs@2.28.2';
  s.onload = run;
  document.head.appendChild(s);
})(function main() {
  // ***** å‰é¢çœç•¥ï¼šEditorJS åˆ‡æ¢ / Supabase ç»‘å®š / ç™»å½• / CRUD / ... *****
  // ... ç›´åˆ°â€œ7. ç”Ÿæˆé™æ€ HTML å¹¶ä¸Šä¼  GitHubâ€è¿™ä¸€æ®µ ***************

  const genBtn = document.getElementById('generateStaticHtmlBtn');
  genBtn.onclick = async () => {
    const title = document.getElementById('newTitle').value.trim();
    // å¦‚æœä½ ç”¨äº†å¯è§†åŒ–ç¼–è¾‘å™¨ï¼Œå°±è¦å…ˆä¿å­˜ï¼Œå¦åˆ™ç›´æ¥å– <textarea> å†…å®¹
    let content = '';
    if (window.editor) {
      const data = await editor.save();
      content = data.blocks.map(b => b.data.text || '').join('\n\n').trim();
    } else {
      content = document.getElementById('newContent').value.trim();
    }

    if (!title || !content) {
      alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');
      return;
    }

    // SEO æ ‡é¢˜ã€å…³é”®è¯ã€æè¿°éƒ½å¯ä»¥è‡ªå·±è¡¥ä¸Šï¼Œè¿™é‡Œç®€åŒ–æ¼”ç¤º
    const createdAt = new Date(Date.now() + 288e5).toISOString().split('T')[0]; // åŒ—äº¬æ—¶é—´ YYYY-MM-DD
    const slug = title
      .toLowerCase()
      .replace(/\s+/g, '-')
      .replace(/[^\w\-]/g, '');

    const coverUrl   = `https://oliverfr.com/covers/${slug}-cover.jpg`;
    const ogImageUrl = `https://oliverfr.com/og-images/${slug}-og.jpg`;
    const logoUrl    = `https://oliverfr.com/assets/logo.png`;

    // ***** è¿™é‡Œä¸€å®šè¦åœ¨æœ€æœ«å°¾ç´§è·Ÿä¸€ä¸ªâ€œåå¼•å·`â€ï¼Œå¦åˆ™ä¸‹é¢çš„ try ... catch éƒ½ä¸ä¼šè¢«æ‰§è¡Œ *****
    const html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>${esc(title)} | MeFan æŠ€æœ¯åšå®¢</title>
  <meta name="description" content="${esc(title)}" />
  <meta name="keywords" content="${esc(title)}" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://oliverfr.com/articles/${slug}.html" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="${esc(title)}" />
  <meta property="og:description" content="${esc(title)}" />
  <meta property="og:image" content="${ogImageUrl}" />
  <meta property="og:url" content="https://oliverfr.com/articles/${slug}.html" />
  <meta property="og:site_name" content="MeFan Tech" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="${esc(title)}" />
  <meta name="twitter:description" content="${esc(title)}" />
  <meta name="twitter:image" content="${ogImageUrl}" />
  <script type="application/ld+json">
  ${JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Article",
    headline: title,
    description: title,
    image: coverUrl,
    author: { "@type": "Person", name: "Oliver F." },
    publisher: {
      "@type": "Organization",
      name: "MeFan Solutions",
      logo: { "@type": "ImageObject", url: logoUrl }
    },
    datePublished: createdAt,
    dateModified:  createdAt,
    mainEntityOfPage: { "@type": "WebPage", "@id": `https://oliverfr.com/articles/${slug}.html` }
  }, null, 2)}
  </script>
  <style>
    body{font-family:Arial,sans-serif;margin:40px auto;max-width:700px;line-height:1.6}
    h1{font-size:28px;margin-bottom:20px}
    .meta{color:#888;font-size:14px;margin-bottom:20px}
    img{max-width:100%;margin:20px 0}
    .logo{display:block;margin:0 auto 20px;height:60px}
  </style>
</head>
<body>
  <img src="${logoUrl}" alt="MeFan Logo" class="logo" />
  <h1>${esc(title)}</h1>
  <div class="meta">release dateï¼š${createdAt} ï½œ authorï¼šOliver F.</div>
  <img src="${coverUrl}" alt="${esc(title)} å°é¢å›¾" />
${marked.parse(content)}
</body></html>`;          // â˜… å¿…é¡»é—­åˆ

// -------------- ä¸‹é¢æ‰æ˜¯å¯æ‰§è¡Œ JS --------------
// ä»»ä½•æ³¨é‡Šå†™åœ¨è¿™é‡Œ
try {
  const res = await fetch('https://upload-articlejs.mefans.workers.dev/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body  : JSON.stringify({ slug, html })
  }).then(r => r.json());

  if (res.success) alert('âœ… å·²å‘å¸ƒä¸Šçº¿ï¼š' + res.url);
  else             alert('âŒ å‘å¸ƒå¤±è´¥ï¼š' + (res.message || JSON.stringify(res)));
} catch (e) {
  alert('âŒ ç½‘ç»œå¼‚å¸¸ï¼š' + e.message);
}


</script>

</body>
</html>
