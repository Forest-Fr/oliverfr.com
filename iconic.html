<script>
document.addEventListener("DOMContentLoaded",function(){
  /* Iconic Module 1 */
  var o1 = document.querySelectorAll("#iconic-openModal"),
      c1 = document.querySelectorAll("#iconic-closeModal"),
      m1 = document.getElementById("iconic-modal"),
      ov1 = document.querySelector(".iconic-popup-container .iconic-modal-overlay");
  function closeOther1(){
    var m = document.getElementById("iconic2-modal");
    if(m && m.classList.contains("active")){
      m.classList.remove("active");
      var o = document.querySelector(".iconic-popup-container .iconic-modal-overlay");
      o && o.classList.remove("active");
    }
  }
  o1.forEach(function(btn){
    btn.addEventListener("click", function(){
      closeOther1();
      m1 && m1.classList.add("active");
      ov1 && ov1.classList.add("active");
    });
  });
  c1.forEach(function(btn){
    btn.addEventListener("click", function(){
      m1 && m1.classList.remove("active");
      ov1 && ov1.classList.remove("active");
    });
  });
  ov1 && ov1.addEventListener("click", function(){
    m1 && m1.classList.remove("active");
    ov1.classList.remove("active");
  });
  /* Iconic Module 2 */
  var o2 = document.querySelectorAll("#iconic2-openModal"),
      c2 = document.querySelectorAll("#iconic2-closeModal"),
      m2 = document.getElementById("iconic2-modal"),
      ov2 = document.querySelector(".iconic-popup-container .iconic-modal-overlay");
  function closeOther2(){
    var m = document.getElementById("iconic-modal");
    if(m && m.classList.contains("active")){
      m.classList.remove("active");
      var o = document.querySelector(".iconic-popup-container .iconic-modal-overlay");
      o && o.classList.remove("active");
    }
  }
  o2.forEach(function(btn){
    btn.addEventListener("click", function(){
      closeOther2();
      m2 && m2.classList.add("active");
      ov2 && ov2.classList.add("active");
    });
  });
  c2.forEach(function(btn){
    btn.addEventListener("click", function(){
      m2 && m2.classList.remove("active");
      ov2 && ov2.classList.remove("active");
    });
  });
  ov2 && ov2.addEventListener("click", function(){
    m2 && m2.classList.remove("active");
    ov2.classList.remove("active");
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded",function(){
  /* Search */
  (function(){
    var bd = document.body, hdr = document.getElementById("mainHeader"), ds = document.getElementById("desktopSearchIcon"),
        ms = document.getElementById("mobileSearchIcon"), sp = document.getElementById("searchPanel"), sc = document.getElementById("searchClose"),
        st = document.getElementById("searchTitle"), sr = document.getElementById("searchResults"),
        site = [{text:"About MeFan",url:"about.html"},{text:"MeFan Lite - Wireless Earbuds",url:"product-lite.html"},{text:"MeFan X1 - Noise Canceling Headphones",url:"product-x1.html"},{text:"MeFan Pro - Premium Audio",url:"product-pro.html"},{text:"Earbud Tips & Support",url:"support.html"},{text:"Contact Us",url:"contact.html"},{text:"Products Overview",url:"products.html"}];
    function openS(){bd.classList.add("search-open"),st.textContent="",sr.innerHTML=""}
    function closeS(){bd.classList.remove("search-open")}
    ds && ds.addEventListener("click",openS);
    ms && ms.addEventListener("click",openS);
    sc && sc.addEventListener("click",closeS);
    document.addEventListener("keydown",function(e){e.key==="Escape"&&closeS()});
    document.addEventListener("click",function(e){if(sp&&!sp.contains(e.target)&&e.target!==ds&&e.target!==ms)closeS()});
    st && st.addEventListener("input",function(){
      var q = st.innerText.trim().toLowerCase();
      if(!q){sr.innerHTML=""; return;}
      var m = site.filter(function(item){return item.text.toLowerCase().includes(q)});
      sr.innerHTML="";
      if(m.length>0){
        m.forEach(function(item){
          var d = document.createElement("div");
          d.classList.add("search-item");
          var a = document.createElement("a");
          a.href = item.url; a.textContent = item.text;
          a.style.textDecoration = "none"; a.style.color="#333"; a.target="_self";
          d.appendChild(a); sr.appendChild(d);
        });
      } else {
        var d = document.createElement("div");
        d.classList.add("no-result"); d.textContent="Sorry, no results found."; sr.appendChild(d);
      }
    });
  })();
  /* Mobile menu */
  (function(){
    var mi = document.getElementById("menuIcon"), cl = document.getElementById("closeBtn"), mn = document.getElementById("mobileNav");
    if(mi && cl && mn){
      mi.addEventListener("click",function(){mn.classList.add("active")});
      cl.addEventListener("click",function(){mn.classList.remove("active")});
      document.querySelectorAll("#mobileNav ul li a").forEach(function(a){a.addEventListener("click",function(){mn.classList.remove("active")})});
    }
  })();
  /* Desktop nav hover & blur */
  (function(){
    var hdr = document.getElementById("mainHeader"), links = document.querySelectorAll(".desktop-nav .nav-list > li > a"),
        hovO = document.getElementById("hover1Overlay"), hovC = document.getElementById("hover1Content"),
        blur = document.getElementById("blur1Bg"),
        secs = {"Home":document.getElementById("hover1Home"),"Products":document.getElementById("hover1Products"),"About":document.getElementById("hover1About"),"Contact":document.getElementById("hover1Contact")};
    function hideAll(){Object.values(secs).forEach(function(el){el && el.classList.remove("active")})}
    function showH(){hovO.classList.add("active"); hovC.classList.add("active"); hdr.classList.add("nav-white"); if(blur) blur.classList.add("active")}
    function hideH(){hovO.classList.remove("active"); hovC.classList.remove("active"); hdr.classList.remove("nav-white"); if(blur) blur.classList.remove("active"); hideAll()}
    links.forEach(function(l){l.addEventListener("mouseenter",function(){var txt=l.textContent.trim(); hideAll(); if(secs[txt]){secs[txt].classList.add("active"); showH()} else {hideH()}})});
    hovC.addEventListener("mouseleave",hideH);
    hovO.addEventListener("mousemove",hideH);
    if(blur) blur.addEventListener("mousemove",hideH);
  })();
  /* Mobile multi-level menu */
  (function(){
    var mn = document.getElementById("mobileNav"), h = document.getElementById("mobileNavLevel2Home"),
        p = document.getElementById("mobileNavLevel2Products"), a = document.getElementById("mobileNavLevel2About"),
        c = document.getElementById("mobileNavLevel2Contact");
    if(!mn || !h || !p || !a || !c){console.log("多级菜单面板未找到"); return;}
    function showSub(panel){mn.classList.remove("active"); h.classList.remove("active"); p.classList.remove("active"); a.classList.remove("active"); c.classList.remove("active"); panel.classList.add("active")}
    function showMain(){h.classList.remove("active"); p.classList.remove("active"); a.classList.remove("active"); c.classList.remove("active"); mn.classList.add("active")}
    document.querySelectorAll("#mobileNav ul li a").forEach(function(l){
      var lvl = l.getAttribute("data-level");
      if(lvl==="home"){l.addEventListener("click",function(e){e.preventDefault(); showSub(h)})}
      else if(lvl==="products"){l.addEventListener("click",function(e){e.preventDefault(); showSub(p)})}
      else if(lvl==="about"){l.addEventListener("click",function(e){e.preventDefault(); showSub(a)})}
      else if(lvl==="contact"){l.addEventListener("click",function(e){e.preventDefault(); showSub(c)})}
    });
    document.querySelectorAll(".menu-panel__back").forEach(function(b){b.addEventListener("click",function(e){e.preventDefault(); showMain()})});
    document.querySelectorAll(".menu-panel__close").forEach(function(b){b.addEventListener("click",function(e){e.preventDefault(); mn.classList.remove("active"); h.classList.remove("active"); p.classList.remove("active"); a.classList.remove("active"); c.classList.remove("active")})})
  })();
});
</script>
</body></html>
