/***************************************************
 * scripts.js
 ***************************************************/
const initHeroCarousel=()=>{const hs=document.getElementById('hero-slides'),ds=document.querySelectorAll('.hero-dots .dot');if(!hs||!ds.length)return;let i=0,t=hs.children.length,up=()=>{i=(i+1)%t;hs.style.transform=`translateX(-${i*100}%)`;ds.forEach((d,j)=>{d.classList.toggle('active',j===i)})};ds.forEach((d,j)=>{d.addEventListener('click',()=>{i=j;hs.style.transform=`translateX(-${i*100}%)`;ds.forEach((d2,k)=>{d2.classList.toggle('active',k===i)})})});setInterval(up,5000)};
const initEmailJS=()=>{if(typeof emailjs==='undefined')return;emailjs.init("HXCThZROMytOt-wyp");const cf=document.getElementById("contactForm");cf&&cf.addEventListener("submit",e=>{e.preventDefault();emailjs.sendForm("service_1ffkva1","template_ypdj9n9",cf).then(()=>{alert("邮件已发送成功，我们将尽快与您联系！");cf.reset()}).catch(err=>{console.error("邮件发送失败：",err);alert("邮件发送失败，请稍后再试。")})})};
const initCompareFeature=()=>{const b=document.querySelector(".compare-features .btn");b&&b.addEventListener("click",()=>{alert("对比功能暂未实现 (预留)！")})};
const initHamburgerMenu=()=>{const m=document.getElementById('menuIcon'),mn=document.getElementById('mobileNav'),c=document.getElementById('closeBtn');if(!m||!mn||!c)return;m.addEventListener('click',()=>{mn.classList.add('active')});c.addEventListener('click',()=>{mn.classList.remove('active')});mn.querySelectorAll('ul li a').forEach(l=>{l.addEventListener('click',()=>{mn.classList.remove('active')})})};
const initModalWindows=()=>{document.querySelectorAll('[data-modal-target]').forEach(t=>{t.addEventListener('click',()=>{const m=document.querySelector(t.getAttribute('data-modal-target'));m&&m.classList.add('active')})});document.querySelectorAll('[data-modal-close]').forEach(b=>{b.addEventListener('click',()=>{const p=b.closest('.modal');p&&p.classList.remove('active')})})};
const initInfiniteScroller=()=>{const s=document.getElementById('infiniteScroller'),pb=document.querySelector('.pause-btn');if(!s||!pb)return;const imgs=["A peaceful brookside setting.png","A scenic riverside bend.png","A serene coastal shore.png","A shaded forest path.png"];let pFlag=false,spd=0.3,lt=0,its=[],trk=document.createElement('div');trk.className='infinite-scroller-track';trk.style.display='flex';trk.style.position='relative';trk.style.transform='translateX(0)';s.appendChild(trk);for(let j=0;j<2;j++)imgs.forEach(src=>{let ic=document.createElement('div');ic.className='infinite-scroller-item';ic.style.position='absolute';ic.style.width='100%';let im=document.createElement('img');im.src=src;im.alt=src;im.style.width='100%';im.style.objectFit='cover';ic.appendChild(im);trk.appendChild(ic);let ox=its.length===0?0:(its[its.length-1].x+ic.offsetWidth);ic.style.left=`${ox}px`;its.push({el:ic,x:ox,width:ic.offsetWidth})});function an(ts){if(!pFlag){let d=ts-lt;lt=ts;let m=spd*(d/16.67);its.forEach(it=>{it.x-=m;it.el.style.left=`${it.x}px`});let last=its[its.length-1];if(last.x+last.width<window.innerWidth+100)createItem(imgs[its.length%imgs.length])}requestAnimationFrame(an)};function createItem(src){let ic=document.createElement('div');ic.className='infinite-scroller-item';ic.style.position='absolute';ic.style.width='100%';let im=document.createElement('img');im.src=src;im.alt=src;im.style.width='100%';im.style.objectFit='cover';ic.appendChild(im);trk.appendChild(ic);let ox=its.length===0?0:(its[its.length-1].x+ic.offsetWidth);ic.style.left=`${ox}px`;its.push({el:ic,x:ox,width:ic.offsetWidth})}pb.classList.remove('paused');pb.addEventListener('click',()=>{pFlag=!pFlag;pb.classList.toggle('paused')});requestAnimationFrame(an)};
document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("infiniteScroller"),t=document.querySelector(".infinite-scroller-track");if(s&&t){t.style.transform="translateX(0)";s.innerHTML+=s.innerHTML}const pb=document.getElementById("pauseBtn");let p=false;pb.addEventListener("click",function(){p=!p;s.style.animationPlayState=p?"paused":"running";pb.textContent=p?"▶":"❚❚"});pb.textContent="❚❚"});
document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".infinite-scroller-track");t&&(t.style.transform="translateX(0)")});
const initProductImageClick=()=>{document.querySelectorAll('.product-card img').forEach(img=>{img.addEventListener('click',()=>{const p=img.alt.toLowerCase().replace(/\s+/g,'-')+".html";window.location.href=p})})};
const initFlipCards=()=>{document.querySelectorAll('.flip-btn-front').forEach(btn=>{btn.addEventListener('click',()=>{btn.closest('.card').style.transform='rotateY(180deg)'})});document.querySelectorAll('.flip-btn-back').forEach(btn=>{btn.addEventListener('click',()=>{btn.closest('.card').style.transform='rotateY(0deg)'})})};
const initFrameAnimation=()=>{const c=document.getElementById('animationCanvas');const ctx=c?.getContext('2d');if(!c||!ctx)return;const imgs=["A young man standing in a natural landscape1.png","A young man standing in a natural landscape2.png","A young man standing in a natural landscape3.png"];let imgObjs=[],fi=0,play=true,al=0,fs=0.02,fiInt=1000/24,ltf=0,loaded=0;const ppb=document.getElementById('playPauseButton'),ac=document.getElementById('animationContainer');imgs.forEach((src,i)=>{let im=new Image();im.src=src;im.onload=()=>{imgObjs[i]=im;loaded++;console.log(`✅ 加载成功: ${src}`);if(loaded===1)requestAnimationFrame(df)};im.onerror=()=>console.error(`❌ 图片加载失败: ${src}`)});function resizeC(){const desk=window.innerWidth>=1024; if(desk){c.width=window.innerWidth;c.height=window.innerHeight*0.75}else{c.width=window.innerWidth;c.height=window.innerHeight*0.6}}window.addEventListener('resize',resizeC);resizeC();function df(ts){if(!play||loaded===0)return; if(ts-ltf>fiInt){ctx.clearRect(0,0,c.width,c.height);let nfi=(fi+1)%imgs.length; if(imgObjs[fi]){ctx.globalAlpha=1-al;drawCover(ctx,imgObjs[fi])} if(imgObjs[nfi]){ctx.globalAlpha=al;drawCover(ctx,imgObjs[nfi])} al+=fs; if(al>=1){al=0;fi=nfi} ltf=ts}requestAnimationFrame(df)};function drawCover(ctx,im){const cr=c.width/c.height,ir=im.width/im.height;let dw,dh,ox,oy; if(ir>cr){dh=c.height*0.9;dw=im.width*(dh/im.height);ox=(c.width-dw)/2;oy=(c.height-dh)/2}else{dw=c.width;dh=im.height*(dw/im.width);ox=0;oy=(c.height-dh)/2} ctx.drawImage(im,ox,oy,dw,dh)};ppb?.addEventListener('click',()=>{play=!play;ppb.textContent=play?"❚❚":"▶"; if(play)requestAnimationFrame(df)});window.addEventListener('DOMContentLoaded',()=>{requestAnimationFrame(df)})};
function initdemo1CarouselTrack(){const cnt=document.querySelector(".demo1-carousel-container"),trk=document.querySelector(".demo1-carousel-track"),sld=Array.from(document.querySelectorAll(".demo1-carousel-slide")),prev=document.querySelector(".demo1-carousel-prev"),next=document.querySelector(".demo1-carousel-next"),dts=Array.from(document.querySelectorAll(".demo1-carousel-dot"));if(!cnt||!trk||sld.length===0||!dts.length){console.warn("Carousel elements not found!");return;}const totReal=6,uni=sld.slice(0,totReal);uni.forEach((s,i)=>{s.setAttribute("data-index",i)});const fs=uni[0],ls=uni[totReal-1],fc=fs.cloneNode(true),lc=ls.cloneNode(true);fc.setAttribute("data-index",0);lc.setAttribute("data-index",totReal-1);trk.insertBefore(lc,trk.firstChild);trk.appendChild(fc);const all=Array.from(trk.querySelectorAll(".demo1-carousel-slide")),totClones=all.length;let cur=1,anim=false;function getSlideW(){return window.innerWidth<=768?Math.floor(window.innerWidth*0.8)+15:(()=>{const s=cnt.querySelector(".demo1-carousel-slide");let w=s?s.getBoundingClientRect().width:0;return w===0?(cnt.clientWidth||window.innerWidth)+15:w+15})()}function upd(){const sw=getSlideW(),off=-cur*sw;trk.style.transform=`translateX(${off}px)`;let di=cur===0?totReal-1:cur===totClones-1?0:cur-1;dts.forEach((d,i)=>{d.classList.toggle("active",i===di)});all.forEach(s=>{s.classList.remove("active","prev","next","shadow");const a=s.querySelector("a");a&&(a.style.pointerEvents="none")});all[cur].classList.add("active");{const a=all[cur].querySelector("a");a&&(a.style.pointerEvents="auto")} const ni=(cur+1)%totClones,pi=(cur-1+totClones)%totClones;all[ni].classList.add("next");all[pi].classList.add("prev");all.forEach(s=>{!s.classList.contains("active")&&s.classList.add("shadow")})}function ns(){if(anim)return;anim=true;cur++;trk.style.transition="transform 0.5s ease-in-out";upd()}function ps(){if(anim)return;anim=true;cur--;trk.style.transition="transform 0.5s ease-in-out";upd()}function js(i){if(anim)return;anim=true;cur=i+1;trk.style.transition="transform 0.5s ease-in-out";upd()}prev?.addEventListener("click",()=>{ps();ri()});next?.addEventListener("click",()=>{ns();ri()});dts.forEach((d,i)=>{d.addEventListener("click",()=>{js(i);ri()})});let iv=setInterval(ns,5000);function ri(){clearInterval(iv);iv=setInterval(ns,5000)};trk.addEventListener("transitionend",()=>{if(cur===totClones-1){trk.style.transition="none";cur=1;upd();void trk.offsetWidth;trk.style.transition="transform 0.5s ease-in-out"} if(cur===0){trk.style.transition="none";cur=totReal;upd();void trk.offsetWidth;trk.style.transition="transform 0.5s ease-in-out"}anim=false});trk.style.transition="none";upd();setTimeout(()=>{trk.style.transition="transform 0.5s ease-in-out"},50);all.forEach(sl=>{sl.addEventListener("click",e=>{if(sl.classList.contains("active")){}else if(sl.classList.contains("next")){e.preventDefault();ns();ri()}else if(sl.classList.contains("prev")){e.preventDefault();ps();ri()}})}) ;const expBtns=document.querySelectorAll('.demo1-explore-btn');expBtns.forEach(b=>{b.addEventListener('click',e=>{const l=e.target.closest('.demo1-carousel-slide')?.querySelector('a');l&&(window.location.href=l.href)})});window.addEventListener("resize",()=>{anim=false;trk.style.transition="none";upd();setTimeout(()=>{trk.style.transition="transform 0.5s ease-in-out"},50)});let startX=0,swipe=false;cnt.addEventListener('touchstart',e=>{if(anim)return;swipe=true;startX=e.touches[0].clientX});cnt.addEventListener('touchmove',e=>{});cnt.addEventListener('touchend',e=>{if(!swipe)return;let endX=e.changedTouches[0].clientX,dist=endX-startX;swipe=false;if(Math.abs(dist)>50){dist<0?ns():ps();ri()}})}
window.addEventListener('load',()=>{initdemo1CarouselTrack()});
const initSpec1CarouselTrack=()=>{const trk=document.querySelector(".spec1-carousel-track"),slds=document.querySelectorAll(".spec1-carousel-slide"),prevBtn=document.querySelector(".spec1-carousel-prev"),nextBtn=document.querySelector(".spec1-carousel-next"),dots=document.querySelectorAll(".spec1-carousel-dot");if(!trk||slds.length===0||!dots.length)return;let cur=1,total=slds.length,sw=slds[0].offsetWidth+15;const fs=slds[0],ls=slds[slds.length-1],fc=fs.cloneNode(true),lc=ls.cloneNode(true);trk.appendChild(fc);trk.insertBefore(lc,trk.firstChild);const tot=total+2;function upd(){const off=-cur*sw;trk.style.transform=`translateX(${off}px)`;slds.forEach((s,i)=>{s.classList.toggle("active",i===cur)});dots.forEach((d,i)=>d.classList.toggle("active",i===cur))}function ns(){cur++;if(cur>=tot){cur=1;trk.style.transition="none";upd();setTimeout(()=>{trk.style.transition="transform 0.5s ease-in-out"},50)}else upd()}function ps(){cur--;if(cur<0){cur=tot-2;trk.style.transition="none";upd();setTimeout(()=>{trk.style.transition="transform 0.5s ease-in-out"},50)}else upd()}function js(i){cur=i;upd()}prevBtn?.addEventListener("click",()=>{ps();ri()});nextBtn?.addEventListener("click",()=>{ns();ri()});dots.forEach((d,i)=>{d.addEventListener("click",()=>{js(i);ri()})});let iv=setInterval(ns,5000);function ri(){clearInterval(iv);iv=setInterval(ns,5000)};setTimeout(()=>{trk.style.transition="none";cur=1;upd();setTimeout(()=>{trk.style.transition="transform 0.5s ease-in-out"},50)},50);if(window.innerWidth<=768){setTimeout(()=>{trk.style.transition="transform 0.3s ease-in-out"},500)};upd();const expBtns=document.querySelectorAll('.spec1-explore-btn');expBtns.forEach(b=>{b.addEventListener('click',e=>{const l=e.target.closest('.spec1-carousel-slide').querySelector('a');l&&(window.location.href=l.href)})})};
document.addEventListener("DOMContentLoaded", initSpec1CarouselTrack);
document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".touch1-carousel-track"),s=Array.from(document.querySelectorAll(".touch1-carousel-slide")),prevBtn=document.querySelector(".touch1-prev-btn"),nextBtn=document.querySelector(".touch1-next-btn");let cur=0,sw=615+15;function upd(){t.style.transform=`translateX(-${cur*sw}px)`;prevBtn.disabled=(cur===0);nextBtn.disabled=(cur===s.length-1)};prevBtn.addEventListener("click",()=>{if(cur>0){cur--;upd()}});nextBtn.addEventListener("click",()=>{if(cur<s.length-1){cur++;upd()}});upd()});
document.addEventListener('DOMContentLoaded',()=>{initHeroCarousel();initEmailJS();initCompareFeature();initHamburgerMenu();initModalWindows();initInfiniteScroller();initProductImageClick();initFlipCards();initFrameAnimation();initDemo1CarouselTrack();initSpec1CarouselTrack();initTouch1CarouselTrack()});
document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".touch1-carousel-track"),s=Array.from(t.children),prevBtn=document.querySelector(".touch1-prev-btn"),nextBtn=document.querySelector(".touch1-next-btn");let cur=0,tot=s.length,sw=615+15;function upd(){t.style.transform=`translateX(-${cur*sw}px)`;prevBtn.disabled=(cur===0);nextBtn.disabled=(cur===tot-1)};prevBtn.addEventListener("click",()=>{if(cur>0){cur--;upd()}});nextBtn.addEventListener("click",()=>{if(cur<tot-1){cur++;upd()}});upd()});
